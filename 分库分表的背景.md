### 什么是分库分表？
其实就是字面意思，很好理解：
1. 分库：从单个数据库拆分成多个数据库的过程，将数据散落在多个数据库中
2. 分表：从单个表拆分成多个表的过程，将数据散落在多个表中

### 为什么要分库分表
##### 关键字：提升性能、增加可用性

###### 从性能上看
随着单库中的数据量越来越大、数据库的查询QPS越来越高，相应的，对数据库的读写所需要的时间也越来越多。数据库的读写性能可能会成为业务发展的瓶颈。对应的，就需要做数据库性能方面的优化。

==如果数据库的查询QPS过高，就需要考虑拆库，通过分库来分担单个数据库的链接压力。==比如，如果查询QPS为3500，假设单库可以支撑1000个连接数的话，那么就可以考虑拆分成4个库，来分散查询连接压力。这样每个库理论上只需要负载875个连接数。

如果单表数据量过大，当数据量超过一定量级后，无论是对于数据查询还是数据更新，在经过索引优化等纯数据库层面的传统优化手段之后，还是可能存在性能问题。这是量变产生了质变，这时候就需要去换个思路来解决问题，==比如：从数据生产源头、数据处理源头来解决问题，既然数据量很大，我们就来个分而治之，化整为零。这就产生了分表，把数据按照一定的规则拆分成多张表，来解决单表环境下无法解决的存取性能问题。==

###### 从可用性上看
单个数据库如果发生意外，很可能会丢失所有数据。尤其是云时代，很多数据库都跑在虚拟机上，如果虚拟机/宿主机发生意外，则可能造成无法挽回的损失。==因此，除了传统的 Master-Slave、Master-Master等部署层面解决可靠性问题外，我们也可以考虑从数据拆分层面解决此问题。==

### 如何分库分表
#### 分库分表方案可以分为以下3种：

![[Pasted image 20221214180041.png]]

#### 如何选择我们自己的切分方案
###### 如果需要分表，那么分多少张表合适？
==阿里巴巴开发手册建议是：==
> 【推荐】单表行数超过500万行或者单表容量超过2GB，才推荐进行[分库分表](https://so.csdn.net/so/search?q=%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8&spm=1001.2101.3001.7020)。  
> 说明：如果预计三年后的数据量根本达不到这个级别，请不要在创建表时就分库分表。

==由于所有的技术都是为业务服务的，那么，我们就先从数据方面回顾下业务背景。==
【问题单】表每日产生数据约8W
【操作日志】表每日产生数据80W（每条问题单产生10条操作日志）
假设系统估计使用年限为5年，那么问题单数据量大约=5年 365天/年 8w/天 = 1.46亿，
那么估算出的表数量如下：
1. 【问题单】需要：1.46亿/500w = 29.2张表， 我们就按32张表来切分；
2. 【操作日志】需要：32 * 10 = 320张表

###### 如果需要分库，那么分多少库合适？

分库的时候除了要考虑平时的业务峰值读写QPS外，还需要考虑到诸如双11大促期间可能达到的==峰值==，需要提前做好预估。

根据我们的实际业务场景，可以根据历史QPS、RT等数据评估计算出分库数量：
总连接数 / 单库可承担最高连接数  = 分库数量